version: 2

models:
  - name: dim_products
    description: "Dimensão de produtos com hierarquia de categorias para star schema"
    columns:
      - name: product_id # PK da dimensão
        description: "Chave primária do produto"
        tests:
          - unique
          - not_null
      - name: product_subcategory_id
        description: "ID da subcategoria do produto"
      - name: product_category_id
        description: "ID da categoria do produto"
      - name: subcategory_name
        description: "Nome da subcategoria"
      - name: category_name
        description: "Nome da categoria"
      - name: standard_cost
        description: "Custo padrão"
      - name: list_price
        description: "Preço de lista"

  - name: dim_sales_persons
    description: "Dimensão de vendedores com testes rigorosos de chaves primárias"
    columns:
      - name: business_entity_id # PK da dimensão
        description: "Chave primária do vendedor"
        tests:
          - unique
          - not_null
      - name: commission_pct
        description: "Percentual de comissão"
      - name: sales_quota
        description: "Cota de vendas"

  - name: dim_sales_reasons
    description: "Dimensão de motivos de venda"
    columns:
      - name: sales_reason_id # PK da dimensão
        description: "Chave primária do motivo"
        tests:
          - unique
          - not_null
      - name: sales_reason_name
        description: "Nome do motivo"
      - name: reason_type
        description: "Tipo do motivo"

  - name: dim_special_offers
    description: "Dimensão de ofertas especiais"
    columns:
      - name: special_offer_id # PK da dimensão
        description: "Chave primária da oferta"
        tests:
          - unique
          - not_null
      - name: discount_percentage
        description: "Percentual de desconto"
      - name: offer_type
        description: "Tipo da oferta"

  - name: dim_territories
    description: "Dimensão de territórios"
    columns:
      - name: territory_id # PK da dimensão
        description: "Chave primária do território"
        tests:
          - unique
          - not_null
      - name: territory_name
        description: "Nome do território"
      - name: country_region_code
        description: "Código do país/região"
      - name: country_region_name
        description: "Nome do país/região"

  - name: dim_date
    description: "Dimensão de datas com chaves de relacionamento para star schema"
    columns:
      - name: order_date_id # PK da dimensão
        description: "Surrogate key da data (YYYYMMDD)"
        tests:
          - unique
          - not_null
      - name: date
        description: "Data completa"
      - name: year
        description: "Ano"
      - name: quarter
        description: "Trimestre"
      - name: month
        description: "Mês"
      - name: day
        description: "Dia"

  # TABELAS FATO
  - name: fct_sales
    description: "Fato transacional final de vendas"
    columns:
      - name: sales_order_detail_id # PK da fato
        description: "Chave primária da linha de venda"
        tests:
          - unique
          - not_null
          
      - name: sales_order_id
        description: "ID do pedido"
        tests:
          - not_null
          
      - name: product_id
        description: "FK para a dimensão de produtos"
        tests:
          - not_null
          - relationships:
              to: ref('dim_products')
              field: product_id
              
      - name: customer_id
        description: "ID do cliente (campo informativo)"
        
      - name: business_entity_id
        description: "FK para a dimensão de vendedores"
        tests:
          - not_null
          - relationships:
              to: ref('dim_sales_persons')
              field: business_entity_id
              
      - name: territory_id
        description: "FK para a dimensão de territórios"
        tests:
          - relationships:
              to: ref('dim_territories')
              field: territory_id
              
      - name: order_date_id
        description: "FK para a dimensão de datas"
        tests:
          - not_null
          - relationships:
              to: ref('dim_date')
              field: order_date_id
              
      - name: special_offer_id
        description: "FK para a dimensão de ofertas especiais"
        tests:
          - not_null
          - relationships:
              to: ref('dim_special_offers')
              field: special_offer_id
              
      - name: sales_reason_id
        description: "FK para a dimensão de motivos de venda"
        tests:
          - not_null
          - relationships:
              to: ref('dim_sales_reasons')
              field: sales_reason_id
              
      - name: total_due
        description: "Valor total do pedido"
      - name: line_total
        description: "Valor total da linha"
      - name: order_quantity
        description: "Quantidade pedida"
      - name: unit_price
        description: "Preço unitário"

  - name: fct_purchases
    description: "Fato transacional de compras para análise de custos"
    columns:
      - name: purchase_order_detail_id # PK da fato
        description: "Chave primária da linha de compra"
        tests:
          - unique
          - not_null
          
      - name: purchase_order_id
        description: "ID da ordem de compra"
        tests:
          - not_null
          
      - name: product_id
        description: "FK para a dimensão de produtos"
        tests:
          - not_null
          - relationships:
              to: ref('dim_products')
              field: product_id
              
      - name: purchase_date_id
        description: "FK para a dimensão de datas"
        tests:
          - not_null
          - relationships:
              to: ref('dim_date')
              field: order_date_id
              
      - name: line_total
        description: "Valor total da linha"
      - name: unit_price
        description: "Preço unitário"
      - name: order_quantity
        description: "Quantidade comprada"
